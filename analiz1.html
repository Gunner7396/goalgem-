<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FUEL ENGINE PRO V51.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #000; color: #fff; font-family: -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        .glass { background: #1c1c1e; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; }
        .in-box { background: #2c2c2e; border: none; border-radius: 8px; padding: 10px; color: #fff; font-weight: 700; text-align: center; width: 100%; font-size: 13px; outline: none; border: 1px solid transparent; transition: 0.2s; }
        .in-box:focus { border-color: #30d158; background: #3a3a3c; }
        .btn-lig { padding: 8px 12px; border-radius: 8px; font-size: 10px; font-weight: 900; background: #1c1c1e; color: #555; border: 1px solid #2c2c2e; flex-shrink: 0; transition: 0.2s; }
        .btn-lig.active { background: #30d158; color: #000; border-color: #30d158; transform: scale(1.05); }
        .mini-card { background: #1c1c1e; border-radius: 12px; padding: 12px; border: 1.5px solid rgba(255,255,255,0.05); margin-bottom: 8px; }
        .win-border { border-color: #30d158 !important; box-shadow: 0 0 15px rgba(48,209,88,0.1); }
        .loss-border { border-color: #ff3b30 !important; box-shadow: 0 0 15px rgba(255,59,48,0.1); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="p-3 pb-24">

    <div class="flex justify-between items-end mb-5 px-1">
        <div>
            <h1 class="text-xl font-black italic tracking-tighter uppercase">FUEL <span class="text-green-500">ENGINE</span> <span class="text-[10px] bg-white/10 px-1 rounded text-gray-400 font-normal ml-1">V51.1</span></h1>
            <div class="flex gap-3 mt-1">
                <div class="text-[9px] font-bold text-gray-500 uppercase tracking-widest">SUCCESS: <span id="wr" class="text-green-500 text-xs">0%</span></div>
                <div class="text-[9px] font-bold text-gray-500 uppercase tracking-widest">W: <span id="wCount" class="text-white">0</span> | L: <span id="lCount" class="text-white">0</span></div>
            </div>
        </div>
        <div class="flex gap-2">
            <button onclick="toggleArchive()" class="p-2 glass text-[10px] font-black text-blue-400 uppercase">Ar≈üiv</button>
            <button onclick="clrAll()" class="p-2 glass text-xs">üóëÔ∏è</button>
        </div>
    </div>

    <div class="flex gap-2 overflow-x-auto no-scrollbar mb-5 py-1">
        <button onclick="sL('PL')" id="l-PL" class="btn-lig active">PREMIER LIG</button>
        <button onclick="sL('LL')" id="l-LL" class="btn-lig">LA LIGA</button>
        <button onclick="sL('SA')" id="l-SA" class="btn-lig">SERIE A</button>
        <button onclick="sL('BL')" id="l-BL" class="btn-lig">BUNDESLIGA</button>
        <button onclick="sL('L1')" id="l-L1" class="btn-lig">LIGUE 1</button>
    </div>

    <div class="glass p-4 mb-6 shadow-2xl">
        <div class="grid grid-cols-2 gap-3 mb-4">
            <input id="hN" placeholder="EV SAHƒ∞Bƒ∞" class="bg-transparent border-b border-gray-800 pb-1 text-[11px] font-black uppercase outline-none focus:border-green-500 transition-all">
            <input id="aN" placeholder="DEPLASMAN" class="bg-transparent border-b border-gray-800 pb-1 text-[11px] font-black uppercase text-right outline-none focus:border-green-500 transition-all">
        </div>
        <div class="grid grid-cols-2 gap-2">
            <input type="number" step="0.001" inputmode="decimal" id="h_xg" class="in-box" placeholder="Ev npxG/Sh">
            <input type="number" step="0.001" inputmode="decimal" id="a_xg" class="in-box" placeholder="Dep npxG/Sh">
            <input type="number" inputmode="decimal" id="h_ppa" class="in-box" placeholder="Ev PPA">
            <input type="number" inputmode="decimal" id="a_ppa" class="in-box" placeholder="Dep PPA">
            <input type="number" inputmode="decimal" id="h_pr" class="in-box" placeholder="Ev PrgR">
            <input type="number" inputmode="decimal" id="a_pr" class="in-box" placeholder="Dep PrgR">
            <input type="number" inputmode="decimal" id="h_sca" class="in-box" placeholder="Ev SCA">
            <input type="number" inputmode="decimal" id="a_sca" class="in-box" placeholder="Dep SCA">
        </div>
        <button onclick="run()" class="w-full bg-[#30d158] text-black font-black py-4 rounded-xl mt-4 text-[12px] uppercase tracking-tighter shadow-lg shadow-green-500/20 active:scale-95 transition-transform">ANALƒ∞Zƒ∞ BA≈ûLAT</button>
    </div>

    <div id="latestCard"></div>
    <div id="archiveContainer" class="hidden mt-4 pt-4 border-t border-dashed border-gray-800">
        <div id="arcList" class="flex flex-col gap-2"></div>
    </div>

    <script>
        const CONFIG = {
            PL: { res: 1.00, ppa_b: 22, sca_b: 45, xg_b: 0.12 },
            LL: { res: 0.85, ppa_b: 18, sca_b: 38, xg_b: 0.10 },
            SA: { res: 0.90, ppa_b: 19, sca_b: 40, xg_b: 0.11 },
            BL: { res: 1.15, ppa_b: 26, sca_b: 52, xg_b: 0.14 },
            L1: { res: 1.00, ppa_b: 20, sca_b: 42, xg_b: 0.12 }
        };

        let cL = 'PL';

        function sL(l){ cL=l; document.querySelectorAll('.btn-lig').forEach(b=>b.classList.remove('active')); document.getElementById('l-'+l).classList.add('active'); }
        function toggleArchive() { document.getElementById('archiveContainer').classList.toggle('hidden'); }

        function run() {
            const getV = (id) => Number(document.getElementById(id).value);
            const ids = ["h_xg","a_xg","h_ppa","a_ppa","h_pr","a_pr","h_sca","a_sca"];
            if (ids.some(id => document.getElementById(id).value === "")) { alert("T√ºm yakƒ±t verilerini girin!"); return; }

            const l = CONFIG[cL];
            const avgXG = (getV("h_xg") + getV("a_xg")) / 2;
            const tPPA = getV("h_ppa") + getV("a_ppa");
            const tSCA = getV("h_sca") + getV("a_sca");
            const tPR = getV("h_pr") + getV("a_pr");
            
            // PrgR/PPA Oranƒ± (≈ûanzƒ±man Verimliliƒüi)
            const ratio = tPR / (tPPA || 1);
            
            // ANALƒ∞Z MOTORU √áEKƒ∞RDEK HESABI (Aƒüƒ±rlƒ±klƒ±)
            const xgP = (avgXG / l.xg_b) * 45; // Bitiricilik %45 aƒüƒ±rlƒ±k
            const ppaP = ((tPPA / l.ppa_b) * l.res) * 40; // Hacim %40 aƒüƒ±rlƒ±k
            const scaP = ((tSCA / l.sca_b) * l.res) * 15; // Aksiyon %15 aƒüƒ±rlƒ±k

            // Verimlilik Limit√∂r√º (Ratio 4.5 ideal kabul edilir)
            let efficiencyMod = 4.5 / (ratio || 1);
            efficiencyMod = Math.min(1.25, Math.max(0.75, efficiencyMod)); // Max %25 etki sƒ±nƒ±rƒ±

            const finalScore = (xgP + ppaP + scaP) * efficiencyMod;

            // Tahmin Kutularƒ± Hassasiyeti (Puanƒ±n merkeze uzaklƒ±ƒüƒ±)
            const c = [
                Math.round(Math.max(0, 100 - Math.abs(finalScore - 48) * 4)), // 2 GOL
                Math.round(Math.max(0, 100 - Math.abs(finalScore - 75) * 4)), // 3 GOL
                Math.round(Math.max(0, 100 - Math.abs(finalScore - 105) * 4)) // 3.5 √úST
            ];

            const item = { 
                hN: document.getElementById('hN').value||"EV", aN: document.getElementById('aN').value||"DEP", 
                c, id: Date.now(), l: cL, res: null, r: ratio.toFixed(1), score: finalScore.toFixed(0)
            };

            let db = JSON.parse(localStorage.getItem('fuel_final_db') || '[]');
            db.push(item);
            localStorage.setItem('fuel_final_db', JSON.stringify(db));
            
            ids.forEach(id => document.getElementById(id).value = "");
            document.getElementById('hN').value = ""; document.getElementById('aN').value = "";
            render();
        }

        function render() {
            const db = JSON.parse(localStorage.getItem('fuel_final_db') || '[]');
            const arcList = document.getElementById('arcList');
            const latest = document.getElementById('latestCard');
            arcList.innerHTML = ""; latest.innerHTML = "";
            let w = 0, l = 0;

            db.forEach((i, idx) => {
                if(i.res === 'W') w++; if(i.res === 'L') l++;
                const bC = i.res === 'W' ? 'win-border' : (i.res === 'L' ? 'loss-border' : '');
                
                const html = `<div class="mini-card relative ${bC} animate-in fade-in duration-500">
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex flex-col">
                            <span class="text-[9px] font-black text-green-500 tracking-widest uppercase">${i.l}</span>
                            <span class="text-[11px] font-bold text-gray-200">${i.hN} vs ${i.aN}</span>
                        </div>
                        <div class="flex gap-1 items-center">
                            <span class="text-[8px] bg-white/5 px-1.5 py-0.5 rounded text-gray-400 font-bold mr-1 italic">RATIO: ${i.r}</span>
                            <button onclick="setR('${i.id}','W')" class="w-6 h-6 rounded-lg text-[10px] font-black ${i.res==='W'?'bg-green-500 text-black shadow-lg shadow-green-500/40':'bg-white/5 text-green-500'}">W</button>
                            <button onclick="setR('${i.id}','L')" class="w-6 h-6 rounded-lg text-[10px] font-black ${i.res==='L'?'bg-red-500 text-black shadow-lg shadow-red-500/40':'bg-white/5 text-red-500'}">L</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-2">
                        ${box("2 GOL", i.c[0], "#30d158")}
                        ${box("3 GOL", i.c[1], "#007aff")}
                        ${box("3.5 √úST", i.c[2], "#ff3b30")}
                    </div>
                    <button onclick="rm('${i.id}')" class="absolute -top-1 -right-1 p-2 text-[10px] opacity-20 font-bold text-white">√ó</button>
                </div>`;
                
                if(idx === db.length - 1) latest.innerHTML = `<p class="text-[8px] font-black text-gray-400 mb-2 px-1 uppercase tracking-widest">Analiz Raporu</p>` + html;
                const div = document.createElement('div'); div.innerHTML = html; arcList.prepend(div);
            });
            
            document.getElementById('wCount').innerText = w;
            document.getElementById('lCount').innerText = l;
            const total = w + l;
            document.getElementById('wr').innerText = total > 0 ? Math.round((w/total)*100) + "%" : "0%";
        }

        function box(l, v, c) {
            const secure = v >= 78; // %78+ Altƒ±n B√∂lge (Kritik Hassasiyet)
            return `<div class="flex flex-col items-center justify-center p-2 rounded-xl bg-white/5 border ${secure?'border-green-500/40':'border-transparent'}">
                <span class="text-[7px] font-bold text-gray-500 mb-1 uppercase tracking-tighter">${l}</span>
                <span class="text-[15px] font-black" style="color:${secure?c:(v>=60?'#fff':'#333')}">%${v}</span>
                ${secure?'<div class="w-1 h-1 bg-green-500 rounded-full mt-1 animate-pulse"></div>':''}
            </div>`;
        }

        function setR(id, r) {
            let db = JSON.parse(localStorage.getItem('fuel_final_db') || '[]');
            db = db.map(i => i.id == id ? {...i, res: i.res === r ? null : r} : i);
            localStorage.setItem('fuel_final_db', JSON.stringify(db));
            render();
        }

        function rm(id) { if(confirm("Silinsin mi?")) { let db = JSON.parse(localStorage.getItem('fuel_final_db') || '[]'); db = db.filter(i => i.id != id); localStorage.setItem('fuel_final_db', JSON.stringify(db)); render(); } }
        function clrAll() { if(confirm("T√ºm veriler temizlensin mi?")) { localStorage.removeItem('fuel_final_db'); render(); } }
        window.onload = render;
    </script>
</body>
</html>

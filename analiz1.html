<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FUEL FINAL V52</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #09090b; color: #fafafa; font-family: -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        .glass { background: #18181b; border: 1px solid #27272a; border-radius: 16px; }
        .in-box { background: #27272a; border: 1px solid transparent; border-radius: 10px; padding: 12px 8px; color: #fff; font-weight: 800; text-align: center; width: 100%; outline: none; transition: 0.2s; }
        .in-box:focus { border-color: #22c55e; background: #3f3f46; }
        .btn-lig { padding: 10px; border-radius: 12px; font-size: 11px; font-weight: 800; background: #18181b; color: #71717a; border: 1px solid #27272a; flex: 1; transition: 0.2s; }
        .btn-lig.active { background: #22c55e; color: #000; border-color: #22c55e; }
        .mini-card { background: #18181b; border-radius: 16px; padding: 14px; border: 1px solid #27272a; margin-bottom: 10px; position: relative; }
        .win-border { border-color: #22c55e !important; box-shadow: 0 0 15px rgba(34,197,94,0.1); }
        .loss-border { border-color: #ef4444 !important; }
        .metric-label { font-size: 9px; font-weight: 900; color: #52525b; text-transform: uppercase; text-align: center; display: block; margin-bottom: 4px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="p-4 pb-28">

    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-black italic tracking-tighter text-white uppercase">FUEL <span class="text-green-500">FINAL</span></h1>
        <div class="flex gap-2">
            <button onclick="toggleArchive()" class="w-10 h-10 glass flex items-center justify-center text-blue-400 font-bold">üìÇ</button>
            <button onclick="clrAll()" class="w-10 h-10 glass flex items-center justify-center text-red-500 font-bold">üóëÔ∏è</button>
        </div>
    </div>

    <div class="flex gap-2 mb-6 overflow-x-auto no-scrollbar py-1">
        <button onclick="sL('PL')" id="l-PL" class="btn-lig active">PL</button>
        <button onclick="sL('LL')" id="l-LL" class="btn-lig">LL</button>
        <button onclick="sL('SA')" id="l-SA" class="btn-lig">SA</button>
        <button onclick="sL('BL')" id="l-BL" class="btn-lig">BL</button>
        <button onclick="sL('L1')" id="l-L1" class="btn-lig">L1</button>
    </div>

    <div class="glass p-5 mb-8 shadow-2xl">
        <div class="grid grid-cols-2 gap-4 mb-6">
            <input id="hN" placeholder="EV SAHƒ∞Bƒ∞" class="bg-transparent border-b-2 border-zinc-800 py-1 text-sm font-black uppercase outline-none focus:border-green-500">
            <input id="aN" placeholder="DEPLASMAN" class="bg-transparent border-b-2 border-zinc-800 py-1 text-sm font-black uppercase text-right outline-none focus:border-green-500">
        </div>

        <div class="space-y-4">
            <div>
                <span class="metric-label">npxG / Shot (Kalite)</span>
                <div class="grid grid-cols-2 gap-2">
                    <input type="number" step="0.001" inputmode="decimal" id="h_xg" class="in-box" placeholder="0.000">
                    <input type="number" step="0.001" inputmode="decimal" id="a_xg" class="in-box" placeholder="0.000">
                </div>
            </div>
            <div>
                <span class="metric-label">PPA (Sƒ±zma G√ºc√º)</span>
                <div class="grid grid-cols-2 gap-2">
                    <input type="number" inputmode="decimal" id="h_ppa" class="in-box" placeholder="0">
                    <input type="number" inputmode="decimal" id="a_ppa" class="in-box" placeholder="0">
                </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <span class="metric-label">PrgR</span>
                    <div class="grid grid-cols-2 gap-1">
                        <input type="number" id="h_pr" class="in-box" placeholder="0">
                        <input type="number" id="a_pr" class="in-box" placeholder="0">
                    </div>
                </div>
                <div>
                    <span class="metric-label">SCA</span>
                    <div class="grid grid-cols-2 gap-1">
                        <input type="number" id="h_sca" class="in-box" placeholder="0">
                        <input type="number" id="a_sca" class="in-box" placeholder="0">
                    </div>
                </div>
            </div>
        </div>

        <button onclick="run()" class="w-full bg-green-500 text-black font-black py-4 rounded-2xl mt-8 text-sm uppercase tracking-widest active:scale-95 transition-all shadow-lg shadow-green-500/20">Sƒ∞STEMƒ∞ ATE≈ûLE</button>
    </div>

    <div id="latestCard"></div>
    <div id="archiveContainer" class="hidden mt-6 space-y-3">
        <p class="text-[9px] font-black text-zinc-600 uppercase tracking-widest ml-1 mb-2">Ge√ßmi≈ü Analizler</p>
        <div id="arcList"></div>
    </div>

    <script>
        const CONFIG = {
            PL: { res: 1.00, ppa_b: 22, sca_b: 45, xg_b: 0.12 },
            LL: { res: 0.85, ppa_b: 18, sca_b: 38, xg_b: 0.10 },
            SA: { res: 0.90, ppa_b: 19, sca_b: 40, xg_b: 0.11 },
            BL: { res: 1.15, ppa_b: 26, sca_b: 52, xg_b: 0.14 },
            L1: { res: 1.00, ppa_b: 20, sca_b: 42, xg_b: 0.12 }
        };

        let cL = 'PL';
        function sL(l){ cL=l; document.querySelectorAll('.btn-lig').forEach(b=>b.classList.remove('active')); document.getElementById('l-'+l).classList.add('active'); }
        function toggleArchive() { document.getElementById('archiveContainer').classList.toggle('hidden'); }

        function run() {
            const g = (id) => Number(document.getElementById(id).value);
            const ids = ["h_xg","a_xg","h_ppa","a_ppa","h_pr","a_pr","h_sca","a_sca"];
            if (ids.some(id => document.getElementById(id).value === "")) return alert("Eksik veri!");

            const l = CONFIG[cL];
            const hX = g("h_xg"), aX = g("a_xg");
            
            // K√úM√úLATƒ∞F KALƒ∞TE (Geli≈ütirilmi≈ü Denge)
            const boss = Math.max(hX, aX), helper = Math.min(hX, aX);
            const cumulativeXG = boss + (helper * 0.45); 

            const tPPA = g("h_ppa") + g("a_ppa");
            const tSCA = g("h_sca") + g("a_sca");
            const ratio = (g("h_pr") + g("a_pr")) / (tPPA || 1);
            
            // Aƒüƒ±rlƒ±klƒ± Puanlama
            const xP = (cumulativeXG / (l.xg_b * 1.15)) * 45;
            const pP = (tPPA / l.ppa_b) * 40;
            const sP = (tSCA / l.sca_b) * 15;

            // Verimlilik Mod√ºlat√∂r√º
            let eM = 4.5 / (ratio || 1);
            eM = Math.min(1.20, Math.max(0.80, eM));

            const score = (xP + pP + sP) * eM;
            
            // %80 Hedefli Kutu Hesaplama (Hassas √áarpan: 4.2)
            const c = [
                Math.round(Math.max(0, 100 - Math.abs(score - 48) * 4.2)),
                Math.round(Math.max(0, 100 - Math.abs(score - 75) * 4.2)),
                Math.round(Math.max(0, 100 - Math.abs(score - 105) * 4.2))
            ];

            const item = { h: document.getElementById('hN').value||"EV", a: document.getElementById('aN').value||"DEP", c, id: Date.now(), l: cL, res: null, r: ratio.toFixed(1) };
            let db = JSON.parse(localStorage.getItem('fuel_final_db') || '[]');
            db.push(item);
            localStorage.setItem('fuel_final_db', JSON.stringify(db));
            
            // Temizlik
            ids.forEach(id => document.getElementById(id).value = "");
            document.getElementById('hN').value = ""; document.getElementById('aN').value = "";
            render();
        }

        function render() {
            const db = JSON.parse(localStorage.getItem('fuel_final_db') || '[]');
            const arcList = document.getElementById('arcList');
            const latest = document.getElementById('latestCard');
            arcList.innerHTML = ""; latest.innerHTML = "";
            
            db.forEach((i, idx) => {
                const bC = i.res === 'W' ? 'win-border' : (i.res === 'L' ? 'loss-border' : '');
                const html = `<div class="mini-card ${bC}">
                    <div class="flex justify-between items-start mb-4">
                        <div><span class="text-[8px] font-black text-zinc-600 uppercase tracking-tighter">${i.l} | RATIO: ${i.r}</span><h3 class="text-xs font-black text-zinc-100 uppercase mt-0.5">${i.h} - ${i.a}</h3></div>
                        <div class="flex gap-1">
                            <button onclick="setR('${i.id}','W')" class="w-8 h-8 rounded-lg text-[10px] font-black ${i.res==='W'?'bg-green-500 text-black':'bg-zinc-800 text-green-500'}">W</button>
                            <button onclick="setR('${i.id}','L')" class="w-8 h-8 rounded-lg text-[10px] font-black ${i.res==='L'?'bg-red-500 text-black':'bg-zinc-800 text-red-500'}">L</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-2">${box("2 GOL", i.c[0], "#22c55e")}${box("3 GOL", i.c[1], "#3b82f6")}${box("3.5 √úST", i.c[2], "#ef4444")}</div>
                </div>`;
                
                if(idx === db.length - 1) latest.innerHTML = `<p class="text-[9px] font-black text-green-500 mb-2 uppercase text-center tracking-widest">Analiz Raporu</p>` + html;
                const div = document.createElement('div'); div.innerHTML = html; arcList.prepend(div);
            });
        }

        function box(l, v, c) {
            const s = v >= 80; // Altƒ±n B√∂lge E≈üiƒüi
            return `<div class="flex flex-col items-center justify-center py-3 rounded-xl ${s?'bg-green-500/10 border border-green-500/30 shadow-[0_0_10px_rgba(34,197,94,0.05)]':'bg-zinc-900/50 border border-transparent'}">
                <span class="text-[7px] font-black text-zinc-500 mb-1 tracking-tighter">${l}</span>
                <span class="text-lg font-black" style="color:${s?c:(v>=60?'#fff':'#3f3f46')}">${v}%</span>
                ${s?'<div class="w-1 h-1 bg-green-500 rounded-full mt-1 animate-ping"></div>':''}
            </div>`;
        }

        function setR(id, r) {
            let db = JSON.parse(localStorage.getItem('fuel_final_db') || '[]');
            db = db.map(i => i.id == id ? {...i, res: i.res === r ? null : r} : i);
            localStorage.setItem('fuel_final_db', JSON.stringify(db));
            render();
        }

        function clrAll() { if(confirm("T√ºm veriler silinecek?")) { localStorage.removeItem('fuel_final_db'); render(); } }
        window.onload = render;
    </script>
</body>
</html>

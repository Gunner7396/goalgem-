<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Score Pro - Otomatik Veri</title>
    <style>
        :root { --bg: #0b0f19; --card: #161e2d; --accent: #10b981; --text: #f8fafc; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 15px; }
        .app-card { max-width: 450px; margin: auto; background: var(--card); padding: 20px; border-radius: 24px; border: 1px solid #2d3748; }
        .status-badge { font-size: 10px; background: #2d3748; padding: 4px 10px; border-radius: 20px; color: var(--accent); margin-bottom: 15px; display: inline-block; }
        input, select { width: 100%; padding: 12px; margin-top: 8px; background: #0b0f19; border: 1px solid #2d3748; color: white; border-radius: 12px; outline: none; }
        .btn-update { background: #3b82f6; color: white; border: none; padding: 10px; border-radius: 10px; font-size: 12px; margin-bottom: 20px; cursor: pointer; width: 100%; }
        .btn-analyze { background: var(--accent); color: #0b0f19; border: none; padding: 18px; border-radius: 15px; font-weight: bold; width: 100%; cursor: pointer; margin-top: 10px; }
        #result { margin-top: 20px; text-align: center; display: none; background: #0b0f19; padding: 20px; border-radius: 15px; }
        .res-val { font-size: 36px; font-weight: 800; color: var(--accent); }
    </style>
</head>
<body>

<div class="app-card">
    <div class="status-badge">â— OTOMATÄ°K VERÄ° SÄ°STEMÄ° AKTÄ°F</div>
    <h2 style="margin-top:0;">Smart Scorer</h2>
    
    <p style="font-size: 12px; color: #94a3b8;">Sistem FBRef Ã¼zerinden en gÃ¼ncel lig istatistiklerini tarar.</p>
    
    <button class="btn-update" onclick="fetchLiveStats()">ğŸ”„ LÄ°STEYÄ° GÃœNCELLE (FBREF)</button>

    <label>Ev Sahibi TakÄ±m</label>
    <select id="evSecim"><option>TakÄ±m SeÃ§iniz...</option></select>

    <label>Deplasman TakÄ±m</label>
    <select id="depSecim"><option>TakÄ±m SeÃ§iniz...</option></select>

    <button class="btn-analyze" onclick="startAnalysis()">ANALÄ°Z ET</button>

    <div id="result">
        <div style="color: #94a3b8; font-size: 14px;">2.5 ÃœST OLASILIÄI</div>
        <div class="res-val" id="percentBox">%0</div>
        <div id="signal" style="margin-top:10px; font-weight:bold;"></div>
    </div>
</div>

<script>
    let globalStats = {};

    // FBRef'ten verileri otomatik Ã§ekme fonksiyonu
    async function fetchLiveStats() {
        const status = document.querySelector('.status-badge');
        status.innerText = "â³ VERÄ°LER Ã‡EKÄ°LÄ°YOR...";
        
        try {
            // CORS Proxy kullanarak FBRef'e baÄŸlanÄ±yoruz
            const url = "https://api.allorigins.win/get?url=" + encodeURIComponent("https://fbref.com/en/comps/26/stats/squads/Turkish-Super-Lig-Stats");
            const response = await fetch(url);
            const data = await response.json();
            
            // HTML iÃ§eriÄŸini iÅŸle
            const parser = new DOMParser();
            const doc = parser.parseFromString(data.contents, 'text/html');
            const table = doc.querySelector('table');
            const rows = table.querySelectorAll('tbody tr');
            
            const evSelect = document.getElementById('evSecim');
            const depSelect = document.getElementById('depSecim');
            
            rows.forEach(row => {
                const teamName = row.querySelector('th[data-stat="team"]').innerText;
                const xG = row.querySelector('td[data-stat="re_xG"]') ? row.querySelector('td[data-stat="re_xG"]').innerText : "1.5";
                
                globalStats[teamName] = parseFloat(xG);
                
                const opt = document.createElement('option');
                opt.value = teamName;
                opt.innerText = teamName;
                evSelect.appendChild(opt.cloneNode(true));
                depSelect.appendChild(opt);
            });
            
            status.innerText = "âœ… VERÄ°LER GÃœNCEL";
            status.style.color = "#10b981";
        } catch (e) {
            status.innerText = "âŒ HATA: MANUEL GÄ°RÄ°ÅE GEÃ‡Ä°N";
            status.style.color = "#ef4444";
        }
    }

    function startAnalysis() {
        const ev = document.getElementById('evSecim').value;
        const dep = document.getElementById('depSecim').value;
        
        const l1 = globalStats[ev] || 1.5;
        const l2 = globalStats[dep] || 1.2;
        const lambda = (l1 + l2);

        // Poisson Hesaplama
        const p0 = Math.exp(-lambda);
        const p1 = lambda * Math.exp(-lambda);
        const p2 = (Math.pow(lambda, 2) * Math.exp(-lambda)) / 2;
        const over25 = (1 - (p0 + p1 + p2)) * 100;

        document.getElementById('result').style.display = 'block';
        document.getElementById('percentBox').innerText = `%${over25.toFixed(1)}`;
        document.getElementById('signal').innerText = over25 > 60 ? "ğŸ”¥ YÃœKSEK SKOR" : "âš–ï¸ DENGELÄ°";
    }
</script>
</body>
</html>


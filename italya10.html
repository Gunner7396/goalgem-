<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Serie A Pro Analiz</title>
    <style>
        :root {
            --bg: #0a0f1e; --card: #161e32; --accent: #00f2ff; --text: #e2e8f0;
            --win: #10b981; --loss: #ef4444; --neutral: #64748b;
        }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; padding-bottom: 50px; }
        .dashboard { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #2d3748; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: center; }
        .stat-box { background: #1e293b; padding: 10px; border-radius: 8px; }
        .stat-val { display: block; font-size: 1.5rem; font-weight: bold; color: var(--accent); }
        
        .team-box { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 10px; }
        .team-name { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: none; background: var(--accent); color: #000; font-weight: bold; box-sizing: border-box; }
        
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
        .inp-group { display: flex; flex-direction: column; }
        label { font-size: 0.7rem; color: #94a3b8; margin-bottom: 2px; }
        input[type="number"] { background: #1e293b; border: 1px solid #334155; color: white; padding: 10px; border-radius: 6px; font-size: 1rem; input-mode: decimal; }

        .btns { display: grid; grid-template-columns: 1fr 2fr; gap: 10px; margin: 15px 0; }
        button { padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .clear-btn { background: #334155; color: white; }
        .analyze-btn { background: var(--win); color: white; }

        .history-title { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
        .result-card { background: var(--card); border-left: 4px solid var(--accent); padding: 15px; border-radius: 8px; margin-bottom: 10px; position: relative; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity:0; transform: translateX(-10px); } }
        
        .card-header { font-weight: bold; font-size: 0.9rem; margin-bottom: 8px; display: flex; justify-content: space-between; }
        .card-metrics { font-size: 0.85rem; color: #cbd5e1; }
        .outcome-btns { margin-top: 10px; display: flex; gap: 5px; }
        .outcome-btns button { padding: 5px 10px; font-size: 0.7rem; flex: 1; }
        .btn-success { background: #065f46; color: white; }
        .btn-fail { background: #7f1d1d; color: white; }
        .delete-single { color: #94a3b8; font-size: 1.2rem; cursor: pointer; }
    </style>
</head>
<body>

    <div class="dashboard">
        <div class="stats-grid">
            <div class="stat-box">
                <span class="stat-val" id="totalMatches">0</span>
                <label>TOPLAM MAÇ</label>
            </div>
            <div class="stat-box">
                <span class="stat-val" id="winRate">%0</span>
                <label>BAŞARI ORANI</label>
            </div>
        </div>
        <button onclick="resetStats()" style="width:100%; margin-top:10px; padding:5px; font-size:0.7rem; background:none; color:#94a3b8; border:1px solid #334155;">İstatistikleri Sıfırla</button>
    </div>

    <div id="inputForm">
        <div class="team-box">
            <input type="text" id="nameA" class="team-name" placeholder="EV SAHİBİ TAKIM">
            <div class="grid" id="gridA"></div>
        </div>
        <div class="team-box">
            <input type="text" id="nameB" class="team-name" placeholder="DEPLASMAN TAKIMI">
            <div class="grid" id="gridB"></div>
        </div>
    </div>

    <div class="btns">
        <button class="clear-btn" onclick="clearInputs()">SİL</button>
        <button class="analyze-btn" onclick="analyze()">ANALİZ ET</button>
    </div>

    <div class="history-title">
        <h3>Analiz Geçmişi</h3>
        <button onclick="clearHistory()" style="background:none; color:var(--loss); font-size:0.8rem; border:none;">Tümünü Temizle</button>
    </div>
    <div id="historyList"></div>

<script>
    const metrics = ["Dist", "CPA", "PrgP", "SCA", "Poss 3rd", "npxG/S", "Blocks", "Interc", "Recovery", "Err"];
    let history = JSON.parse(localStorage.getItem('serieA_history')) || [];
    let stats = JSON.parse(localStorage.getItem('serieA_stats')) || { total: 0, wins: 0 };

    function init() {
        ['A', 'B'].forEach(t => {
            const container = document.getElementById('grid' + t);
            metrics.forEach(m => {
                container.innerHTML += `
                <div class="inp-group">
                    <label>${m}</label>
                    <input type="number" id="${m}_${t}" step="any" inputmode="decimal" placeholder="0.0">
                </div>`;
            });
        });
        updateStats();
        renderHistory();
    }

    function analyze() {
        const nameA = document.getElementById('nameA').value || "Takım A";
        const nameB = document.getElementById('nameB').value || "Takım B";
        
        // Mantık: Gol olasılığı SCA ve CPA toplamına, hata oranına bağlıdır
        const scaTotal = (parseFloat(document.getElementById('SCA_A').value) || 0) + (parseFloat(document.getElementById('SCA_B').value) || 0);
        const errTotal = (parseFloat(document.getElementById('Err_A').value) || 0) + (parseFloat(document.getElementById('Err_B').value) || 0);
        
        let goalProb = Math.min(95, 20 + (scaTotal * 0.8) + (errTotal * 10));
        let scorePred = goalProb > 65 ? "2.5 ÜST / 2-3 GOL" : "2.5 ALT / 0-1 GOL";

        const newAnalysis = {
            id: Date.now(),
            teams: `${nameA} vs ${nameB}`,
            prediction: scorePred,
            prob: goalProb.toFixed(0),
            status: 'pending' // pending, win, loss
        };

        history.unshift(newAnalysis);
        save();
        renderHistory();
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function renderHistory() {
        const list = document.getElementById('historyList');
        list.innerHTML = '';
        history.forEach(item => {
            list.innerHTML += `
            <div class="result-card" style="border-color: ${item.status === 'win' ? 'var(--win)' : item.status === 'loss' ? 'var(--loss)' : 'var(--accent)'}">
                <div class="card-header">
                    <span>${item.teams}</span>
                    <span class="delete-single" onclick="deleteSingle(${item.id})">×</span>
                </div>
                <div class="card-metrics">
                    Tahmin: <b>${item.prediction}</b> (%${item.prob})
                </div>
                ${item.status === 'pending' ? `
                <div class="outcome-btns">
                    <button class="btn-success" onclick="markStatus(${item.id}, 'win')">TUTTU</button>
                    <button class="btn-fail" onclick="markStatus(${item.id}, 'loss')">YATMADI</button>
                </div>` : `<div style="margin-top:5px; font-size:0.7rem; font-weight:bold; color:${item.status === 'win' ? 'var(--win)' : 'var(--loss)'}">${item.status.toUpperCase()}</div>`}
            </div>`;
        });
    }

    function markStatus(id, status) {
        const item = history.find(h => h.id === id);
        if (item && item.status === 'pending') {
            item.status = status;
            stats.total++;
            if (status === 'win') stats.wins++;
            save();
            updateStats();
            renderHistory();
        }
    }

    function updateStats() {
        document.getElementById('totalMatches').innerText = stats.total;
        const rate = stats.total === 0 ? 0 : Math.round((stats.wins / stats.total) * 100);
        document.getElementById('winRate').innerText = `%${rate}`;
        if(stats.total >= 100) alert("100 Maçlık Rapor Tamamlandı! Başarı Oranı: %" + rate);
    }

    function deleteSingle(id) {
        history = history.filter(h => h.id !== id);
        save();
        renderHistory();
    }

    function clearInputs() {
        document.querySelectorAll('input').forEach(i => i.value = '');
    }

    function clearHistory() {
        if(confirm("Tüm geçmişi sil?")) { history = []; save(); renderHistory(); }
    }

    function resetStats() {
        if(confirm("İstatistikleri sıfırla?")) { stats = { total: 0, wins: 0 }; save(); updateStats(); }
    }

    function save() {
        localStorage.setItem('serieA_history', JSON.stringify(history));
        localStorage.setItem('serieA_stats', JSON.stringify(stats));
    }

    init();
</script>
</body>
</html>

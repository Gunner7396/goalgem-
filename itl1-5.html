<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BETON ANALƒ∞Z PRO v10.2</title>
    <style>
        :root {
            --bg: #0b0e11; --card: #15191e; --accent: #00ff88; --text: #ffffff;
            --muted: #8e96a1; --border: #252a31; --danger: #ff4d4d; --success: #00ff88; --warning: #ffcc00;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            font-family: 'Inter', -apple-system, sans-serif; 
            background: var(--bg); color: var(--text); padding: 0; margin: 0; 
            display: flex; justify-content: center; height: 100vh; overflow: hidden;
        }
        .app-container { width: 100%; max-width: 480px; display: flex; flex-direction: column; height: 100%; position: relative; }

        /* FIXED HEADER (HER ZAMAN √úSTTE) */
        .header { 
            position: sticky; top: 0; 
            padding: 15px 20px; background: var(--bg); 
            display: flex; justify-content: space-between; align-items: center; 
            border-bottom: 1px solid var(--border); z-index: 1000; 
        }
        .brand { font-size: 1rem; font-weight: 900; color: var(--accent); }
        .stats-badge { background: #1e2329; padding: 6px 12px; border-radius: 20px; font-size: 0.7rem; border: 1px solid var(--border); font-weight: 700; color: white; }

        /* SCROLLABLE CONTENT */
        .scroll-area { flex-grow: 1; overflow-y: auto; padding: 15px; padding-bottom: 120px; scrollbar-width: none; }
        .scroll-area::-webkit-scrollbar { display: none; }

        /* INPUT CARD */
        .input-card { background: var(--card); border-radius: 16px; padding: 16px; border: 1px solid var(--border); margin-bottom: 20px; }
        .league-select { width: 100%; background: #1e2329; border: 1px solid var(--border); color: #fff; padding: 10px; border-radius: 10px; margin-bottom: 12px; font-weight: 700; appearance: none; text-align: center; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .team-box { background: rgba(255,255,255,0.03); padding: 10px; border-radius: 12px; }
        .name-input { width: 100%; background: transparent; border: none; border-bottom: 1px solid var(--border); color: var(--text); padding: 5px 0; margin-bottom: 10px; font-size: 0.8rem; font-weight: 800; text-align: center; }
        
        .field-row { margin-bottom: 8px; }
        .field-row label { display: block; font-size: 0.5rem; color: var(--muted); margin-bottom: 2px; font-weight: 800; }
        .field-row input { width: 100%; background: #1e2329; border: 1px solid var(--border); color: #fff; padding: 6px; border-radius: 6px; font-size: 0.8rem; }

        /* CARDS */
        .analysis-card { background: var(--card); border-radius: 18px; padding: 15px; margin-bottom: 12px; border: 1px solid var(--border); animation: slideUp 0.3s ease; }
        .card-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .score-circle { width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; font-weight: 900; border: 3px solid var(--accent); }
        .match-info { flex: 1; text-align: center; }
        .team-names { font-size: 0.8rem; font-weight: 800; }

        .outcome-bar { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; border-top: 1px solid var(--border); padding-top: 12px; }
        .out-btn { background: #1e2329; border: 1px solid var(--border); color: var(--muted); padding: 10px; border-radius: 10px; font-size: 0.6rem; font-weight: 800; cursor: pointer; }
        .out-btn.win.active { background: var(--success); color: #000; box-shadow: 0 0 10px var(--success); }
        .out-btn.lose.active { background: var(--danger); color: #fff; box-shadow: 0 0 10px var(--danger); }

        /* FOOTER */
        .footer { position: absolute; bottom: 0; width: 100%; padding: 15px; background: linear-gradient(0deg, var(--bg) 80%, transparent); }
        .btn-main { width: 100%; background: var(--accent); color: #000; border: none; padding: 16px; border-radius: 14px; font-weight: 900; font-size: 1rem; box-shadow: 0 8px 20px rgba(0,255,136,0.3); }

        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <div class="brand">BETON<span style="color:#fff; font-weight:300;">PRO</span></div>
        <div class="stats-badge">
            ü§ñ LDR: <span id="total-count" style="color:var(--accent)">0</span>/100 ‚Ä¢ 
            üéØ <span id="success-rate" style="color:var(--accent)">%0</span>
        </div>
    </div>

    <div class="scroll-area" id="main-scroll">
        <div class="input-card">
            <select id="league" class="league-select" onchange="updateStatsDisplay()">
                <option value="ita">SERIE A (ƒ∞TALYA)</option>
                <option value="esp">LA LIGA (ƒ∞SPANYA)</option>
                <option value="fra">LIGUE 1 (FRANSA)</option>
                <option value="eng">PREMIER LEAGUE (ƒ∞NGƒ∞LTERE)</option>
                <option value="ger">BUNDESLIGA (ALMANYA)</option>
            </select>

            <div class="grid">
                <div class="team-box">
                    <input type="text" id="h_name" class="name-input" placeholder="EV TAKIMI">
                    <div class="field-row"><label>npxG/Sh</label><input type="text" id="h_n" inputmode="decimal"></div>
                    <div class="field-row"><label>PPA</label><input type="text" id="h_p" inputmode="decimal"></div>
                    <div class="field-row"><label>Drb Past</label><input type="text" id="h_d" inputmode="decimal"></div>
                    <div class="field-row"><label>Att 3rd</label><input type="text" id="h_t" inputmode="decimal"></div>
                </div>
                <div class="team-box">
                    <input type="text" id="a_name" class="name-input" placeholder="DEP TAKIMI">
                    <div class="field-row"><label>npxG/Sh</label><input type="text" id="a_n" inputmode="decimal"></div>
                    <div class="field-row"><label>PPA</label><input type="text" id="a_p" inputmode="decimal"></div>
                    <div class="field-row"><label>Drb Past</label><input type="text" id="a_d" inputmode="decimal"></div>
                    <div class="field-row"><label>Att 3rd</label><input type="text" id="a_t" inputmode="decimal"></div>
                </div>
            </div>
            <div style="display:flex; justify-content:space-between; margin-top:10px;">
                <button onclick="inputTemizle()" style="background:none; border:none; color:var(--muted); font-size:0.6rem; font-weight:700;">TEMƒ∞ZLE</button>
                <button onclick="fullReset()" style="background:none; border:none; color:var(--danger); font-size:0.6rem; font-weight:700;">SIFIRLA</button>
            </div>
        </div>
        <div id="results"></div>
    </div>

    <div class="footer">
        <button class="btn-main" onclick="hesapla()">ANALƒ∞Zƒ∞ BA≈ûLAT</button>
    </div>
</div>

<script>
    const STORAGE_KEY = 'beton_pro_v10_2';
    let brain;
    try { brain = JSON.parse(localStorage.getItem(STORAGE_KEY)) || getDefaultBrain(); } catch(e) { brain = getDefaultBrain(); }

    function getDefaultBrain() {
        return {
            ita: { npxg: 0.08, ppa: 8.0, drib: 12, history: [] },
            esp: { npxg: 0.08, ppa: 7.5, drib: 11, history: [] },
            fra: { npxg: 0.08, ppa: 7.5, drib: 10, history: [] },
            eng: { npxg: 0.075, ppa: 8.5, drib: 13, history: [] },
            ger: { npxg: 0.07, ppa: 6.5, drib: 10, history: [] }
        };
    }

    function saveBrain() { localStorage.setItem(STORAGE_KEY, JSON.stringify(brain)); }
    function cleanNum(val) { return parseFloat(String(val).replace(',', '.').replace(/\s/g, '')) || 0; }
    function inputTemizle() { document.querySelectorAll('input').forEach(i => i.value = ""); }
    function fullReset() { if(confirm("T√ºm veriler sƒ±fƒ±rlansƒ±n mƒ±?")) { brain = getDefaultBrain(); saveBrain(); location.reload(); } }

    function updateStatsDisplay() {
        const lKey = document.getElementById('league').value;
        const hist = brain[lKey].history;
        const wins = hist.filter(h => h.status === 'win').length;
        document.getElementById('total-count').innerText = hist.length;
        document.getElementById('success-rate').innerText = hist.length > 0 ? `%${Math.round((wins/hist.length)*100)}` : '%0';
    }

    function hesapla() {
        const lKey = document.getElementById('league').value;
        const cfg = brain[lKey];
        const d = {
            h: document.getElementById('h_name').value || "EV",
            a: document.getElementById('a_name').value || "DEP",
            hn: cleanNum(document.getElementById('h_n').value), an: cleanNum(document.getElementById('a_n').value),
            hp: cleanNum(document.getElementById('h_p').value), ap: cleanNum(document.getElementById('a_p').value),
            hd: cleanNum(document.getElementById('h_d').value), ad: cleanNum(document.getElementById('a_d').value),
            ht: cleanNum(document.getElementById('h_t').value), at: cleanNum(document.getElementById('a_t').value)
        };

        if(!d.hn || !d.an) { alert("Verileri eksiksiz girin!"); return; }

        let score = 0;
        if (d.hn <= cfg.npxg && d.an <= cfg.npxg) score += 40;
        if (d.hp <= cfg.ppa && d.ap <= cfg.ppa) score += 30;
        if (d.hd <= cfg.drib && d.ad <= cfg.drib) score += 10;
        const totalT = d.ht + d.at;
        if (totalT > 0 && (d.ht/totalT)*100 >= 42 && (d.ht/totalT)*100 <= 58) score += 20;

        renderCard(Date.now() + Math.random(), d.h, d.a, score, lKey);
    }

    function renderCard(id, h, a, score, lKey) {
        const color = score >= 80 ? 'var(--success)' : (score >= 60 ? 'var(--warning)' : 'var(--muted)');
        const card = document.createElement('div');
        card.className = "analysis-card";
        card.id = `card-${id}`;
        card.innerHTML = `
            <div class="card-top">
                <div class="score-circle" style="border-color:${color}; color:${color}">${score}</div>
                <div class="match-info">
                    <div class="league-tag">${lKey.toUpperCase()}</div>
                    <div class="team-names">${h} vs ${a}</div>
                </div>
                <button onclick="this.parentElement.parentElement.remove()" style="background:none; border:none; color:var(--border); font-size:1.5rem;">&times;</button>
            </div>
            <div class="outcome-bar">
                <button class="out-btn win" onclick="setOutcome('${lKey}', '${id}', 'win')">ALT Bƒ∞TTƒ∞ ‚úÖ</button>
                <button class="out-btn lose" onclick="setOutcome('${lKey}', '${id}', 'lose')">√úST Bƒ∞TTƒ∞ ‚ùå</button>
            </div>
        `;
        document.getElementById('results').prepend(card);
    }

    function setOutcome(lKey, id, status) {
        const hist = brain[lKey].history;
        const idx = hist.findIndex(h => h.id == id);
        if(idx > -1) hist[idx].status = status; else hist.push({ id, status });
        
        saveBrain(); updateStatsDisplay();
        const card = document.getElementById(`card-${id}`);
        card.querySelectorAll('.out-btn').forEach(b => b.classList.remove('active'));
        card.querySelector(status === 'win' ? '.win' : '.lose').classList.add('active');

        if(hist.length >= 100) {
            const wr = hist.filter(h => h.status === 'win').length / 100;
            if(wr < 0.80) { brain[lKey].npxg *= 0.95; brain[lKey].ppa *= 0.95; alert("‚ö†Ô∏è OTOMATƒ∞K √ñƒûRENME: Ba≈üarƒ± d√º≈ü√ºk, kriterler %5 daraltƒ±ldƒ±."); }
            brain[lKey].history = []; saveBrain(); updateStatsDisplay();
        }
    }
    updateStatsDisplay();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AkÄ±llÄ± Analiz Terminali</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-color: #f8fafc;
            --primary: #00ff88;
            --secondary: #38bdf8;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 10px;
            padding-bottom: 50px;
        }

        h2 { text-align: center; color: var(--primary); margin-bottom: 15px; }

        .container { max-width: 500px; margin: auto; }

        .config-card, .team-card, .analysis-card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .input-group { margin-bottom: 10px; }
        label { display: block; font-size: 0.85rem; margin-bottom: 4px; color: #94a3b8; }
        
        input, select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #334155;
            background: #0f172a;
            color: white;
            font-size: 1rem;
            box-sizing: border-box;
        }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            margin-top: 5px;
        }

        .btn-analyze { background: var(--primary); color: #000; font-size: 1.1rem; }
        .btn-clear { background: #475569; color: white; margin-top: 10px; }
        .btn-delete-all { background: var(--danger); color: white; margin-top: 20px; }

        /* Analiz KartlarÄ± */
        .history-item {
            background: var(--card-bg);
            border-left: 5px solid var(--secondary);
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            position: relative;
        }

        .score-box { font-size: 1.2rem; font-weight: bold; margin: 10px 0; }
        .tag { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; background: #334155; }
        
        .result-actions { display: flex; gap: 5px; margin-top: 10px; }
        .btn-win { background: #22c55e; color: white; flex: 1; padding: 5px; font-size: 0.8rem; }
        .btn-loss { background: var(--danger); color: white; flex: 1; padding: 5px; font-size: 0.8rem; }
        .btn-del-single { position: absolute; top: 10px; right: 10px; background: none; color: #64748b; width: auto; padding: 0; }

        .report-section { background: #1e293b; border: 1px solid var(--secondary); padding: 10px; border-radius: 8px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h2>AKILLI ANALÄ°Z v1.0</h2>

    <div class="config-card">
        <label>LÄ°G SEÃ‡Ä°MÄ°</label>
        <select id="leagueSelect" onchange="updateLeagueStats()">
            <option value="1.00">Ä°talya Serie A (1.00)</option>
            <option value="1.10">Ä°spanya La Liga (1.10)</option>
            <option value="0.75">Almanya Bundesliga (0.75)</option>
            <option value="0.85">Ä°ngiltere Premier Lig (0.85)</option>
            <option value="1.20">TÃ¼rkiye SÃ¼per Lig (1.20)</option>
            <option value="1.00">DiÄŸer (1.00)</option>
        </select>
        <div id="leagueReport" style="margin-top:10px; font-size:0.85rem; color: var(--secondary);"></div>
    </div>

    <div class="grid-2">
        <div class="team-card">
            <input type="text" id="homeName" placeholder="Ev TakÄ±mÄ±" style="margin-bottom:10px; border-color: var(--primary);">
            <div class="input-group"><label>npxG/Sh</label><input type="number" step="0.01" class="m-input" id="h_npxG"></div>
            <div class="input-group"><label>Touches (Att Pen)</label><input type="number" class="m-input" id="h_attPen"></div>
            <div class="input-group"><label>SCA</label><input type="number" class="m-input" id="h_sca"></div>
            <div class="input-group"><label>PrgC into Pen</label><input type="number" class="m-input" id="h_prgC"></div>
            <div class="input-group"><label>Opp Touches</label><input type="number" class="m-input" id="h_opp"></div>
            <div class="input-group"><label>Tkl+Int</label><input type="number" class="m-input" id="h_tkl"></div>
        </div>
        <div class="team-card">
            <input type="text" id="awayName" placeholder="Dep TakÄ±mÄ±" style="margin-bottom:10px; border-color: var(--secondary);">
            <div class="input-group"><label>npxG/Sh</label><input type="number" step="0.01" class="m-input" id="a_npxG"></div>
            <div class="input-group"><label>Touches (Att Pen)</label><input type="number" class="m-input" id="a_attPen"></div>
            <div class="input-group"><label>SCA</label><input type="number" class="m-input" id="a_sca"></div>
            <div class="input-group"><label>PrgC into Pen</label><input type="number" class="m-input" id="a_prgC"></div>
            <div class="input-group"><label>Opp Touches</label><input type="number" class="m-input" id="a_opp"></div>
            <div class="input-group"><label>Tkl+Int</label><input type="number" class="m-input" id="a_tkl"></div>
        </div>
    </div>

    <button class="btn-analyze" onclick="runAnalysis()">ANALÄ°Z ET VE KAYDET</button>
    <button class="btn-clear" onclick="clearForm()">FORMU TEMÄ°ZLE (YENÄ° MAÃ‡)</button>

    <div id="historyList">
        </div>

    <button class="btn-delete-all" onclick="deleteAllHistory()">TÃœM GEÃ‡MÄ°ÅÄ° SÄ°L</button>
</div>

<script>
    // EÅÄ°KLER
    const THRESHOLDS = { npxG: 0.09, attPen: 18, sca: 22, prgC: 2.5, opp: 18, tkl: 12 };

    function runAnalysis() {
        const leagueK = parseFloat(document.getElementById('leagueSelect').value);
        const leagueName = document.getElementById('leagueSelect').options[document.getElementById('leagueSelect').selectedIndex].text;
        const hName = document.getElementById('homeName').value || "Ev";
        const aName = document.getElementById('awayName').value || "Dep";

        // Verileri Topla
        const data = {
            h: { npxG: getVal('h_npxG'), attPen: getVal('h_attPen'), sca: getVal('h_sca'), prgC: getVal('h_prgC'), opp: getVal('h_opp'), tkl: getVal('h_tkl') },
            a: { npxG: getVal('a_npxG'), attPen: getVal('a_attPen'), sca: getVal('a_sca'), prgC: getVal('a_prgC'), opp: getVal('a_opp'), tkl: getVal('a_tkl') }
        };

        // Hesaplama MantÄ±ÄŸÄ±
        let score25 = 85; 
        let riskFactors = 0;

        // Basit SÄ±nÄ±r KontrolÃ¼
        [data.h, data.a].forEach(team => {
            if (team.npxG > THRESHOLDS.npxG * leagueK) { score25 -= 15; riskFactors++; }
            if (team.attPen > THRESHOLDS.attPen * leagueK) { score25 -= 10; riskFactors++; }
            // SÄ±nÄ±rda kalma cezasÄ± (%10 yakÄ±nlÄ±k)
            if (team.npxG > (THRESHOLDS.npxG * leagueK * 0.9)) riskFactors++;
        });

        const id = Date.now();
        const analysis = {
            id, leagueName, hName, aName,
            score25: Math.max(score25, 10),
            score35: Math.min(score25 + 20, 98),
            status: 'pending' // pending, win, loss
        };

        saveToHistory(analysis);
        renderHistory();
    }

    function getVal(id) {
        let val = document.getElementById(id).value;
        return parseFloat(val.replace(',', '.')) || 0;
    }

    function clearForm() {
        document.querySelectorAll('.m-input').forEach(input => input.value = "");
        document.getElementById('homeName').value = "";
        document.getElementById('awayName').value = "";
    }

    // HAFIZA SÄ°STEMÄ°
    function saveToHistory(obj) {
        let history = JSON.parse(localStorage.getItem('bet_history') || '[]');
        history.unshift(obj);
        localStorage.setItem('bet_history', JSON.stringify(history));
    }

    function renderHistory() {
        const history = JSON.parse(localStorage.getItem('bet_history') || '[]');
        const list = document.getElementById('historyList');
        list.innerHTML = "";

        history.forEach(item => {
            const div = document.createElement('div');
            div.className = 'history-item';
            div.innerHTML = `
                <button class="btn-del-single" onclick="deleteSingle('${item.id}')">âœ•</button>
                <div class="tag">${item.leagueName}</div>
                <div style="font-weight:bold; margin-top:5px;">${item.hName} - ${item.aName}</div>
                <div class="score-box">
                    <span style="color:var(--primary)">%${item.score25} (2.5 ALT)</span><br>
                    <span style="color:var(--secondary); font-size:0.9rem;">%${item.score35} (3.5 ALT)</span>
                </div>
                <div class="result-actions" id="actions-${item.id}">
                    ${item.status === 'pending' ? `
                        <button class="btn-win" onclick="setResult('${item.id}', 'win')">ALT BÄ°TTÄ° âœ…</button>
                        <button class="btn-loss" onclick="setResult('${item.id}', 'loss')">ÃœST BÄ°TTÄ° âŒ</button>
                    ` : `<div style="color:${item.status === 'win' ? 'var(--primary)' : 'var(--danger)'}">
                            SonuÃ§: ${item.status === 'win' ? 'BAÅARILI' : 'BAÅARISIZ'}
                         </div>`}
                </div>
            `;
            list.appendChild(div);
        });
        updateLeagueStats();
    }

    function setResult(id, res) {
        let history = JSON.parse(localStorage.getItem('bet_history') || '[]');
        let item = history.find(x => x.id == id);
        if(item) item.status = res;
        localStorage.setItem('bet_history', JSON.stringify(history));
        renderHistory();
    }

    function deleteSingle(id) {
        let history = JSON.parse(localStorage.getItem('bet_history') || '[]');
        history = history.filter(x => x.id != id);
        localStorage.setItem('bet_history', JSON.stringify(history));
        renderHistory();
    }

    function deleteAllHistory() {
        if(confirm("TÃ¼m geÃ§miÅŸ silinsin mi?")) {
            localStorage.removeItem('bet_history');
            renderHistory();
        }
    }

    function updateLeagueStats() {
        const history = JSON.parse(localStorage.getItem('bet_history') || '[]');
        const currentLeague = document.getElementById('leagueSelect').options[document.getElementById('leagueSelect').selectedIndex].text;
        
        const leagueMatches = history.filter(x => x.leagueName === currentLeague && x.status !== 'pending');
        const wins = leagueMatches.filter(x => x.status === 'win').length;
        
        const report = document.getElementById('leagueReport');
        if(leagueMatches.length > 0) {
            const perc = ((wins / leagueMatches.length) * 100).toFixed(0);
            report.innerHTML = `ğŸ“Š Bu Lig PerformansÄ±: ${leagueMatches.length} MaÃ§ / %${perc} BaÅŸarÄ±`;
        } else {
            report.innerHTML = "ğŸ“Š Bu lig iÃ§in henÃ¼z tamamlanmÄ±ÅŸ analiz yok.";
        }
    }

    // BaÅŸlangÄ±Ã§ta GeÃ§miÅŸi YÃ¼kle
    window.onload = renderHistory;
</script>

</body>
</html>

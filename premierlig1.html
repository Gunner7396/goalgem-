function analyzeMatch() {
    const d = {
        tA: document.getElementById('teamA').value, tB: document.getElementById('teamB').value,
        an: parseFloat(document.getElementById('anpxG').value || 0), as: parseFloat(document.getElementById('aSCA').value || 0),
        ar: parseFloat(document.getElementById('aPrgR').value || 0), ap: parseFloat(document.getElementById('aPPA').value || 0),
        bn: parseFloat(document.getElementById('bnpxG').value || 0), bs: parseFloat(document.getElementById('bSCA').value || 0),
        br: parseFloat(document.getElementById('bPrgR').value || 0), bp: parseFloat(document.getElementById('bPPA').value || 0)
    };

    if(!d.tA || !d.tB) return;

    const maxQuality = Math.max(d.an, d.bn);
    const totalSCA = d.as + d.bs;
    const totalPrgR = d.ar + d.br;
    const totalPPA = d.ap + d.bp;
    
    let res, cls, bg, note, prob;

    // GELİŞMİŞ İHTİMAL ALGORİTMASI
    if (maxQuality < 0.09 && totalSCA < 24 && totalPPA < 12) {
        res = "1.5 ALT"; cls = "text-emerald-400"; bg = "bg-emerald-400/10";
        prob = Math.min(85, 70 + (0.09 - maxQuality) * 100); 
        note = "Savunmalar kilit, üretim kısır. 1.5 Alt havuzuna tam uyum.";
    } else if (maxQuality > 0.12 || totalSCA > 38 || totalPrgR > 70) {
        res = "3+ GOL"; cls = "text-red-400"; bg = "bg-red-400/10";
        prob = Math.min(92, 65 + (maxQuality - 0.11) * 200 + (totalSCA / 2));
        note = `Yüksek patlama riski! Kalite ${maxQuality} ve üretim ${totalSCA} SCA ile savunma felç olur.`;
    } else {
        res = "TAM 2 GOL"; cls = "text-amber-400"; bg = "bg-amber-400/10";
        prob = 75; 
        note = "Sınır bölgesi. Takımlar birbirini bir yere kadar çözer. En yakın skorlar 1-1 veya 2-0.";
    }

    const analysis = { id: Date.now(), ...d, res, cls, bg, note, maxQuality, totalSCA, totalPrgR, totalPPA, prob: prob.toFixed(0) };
    let logs = JSON.parse(localStorage.getItem('pLogs') || '[]');
    logs.unshift(analysis);
    localStorage.setItem('pLogs', JSON.stringify(logs));
    displayHistory();
}

// displayHistory içindeki HTML yapısını da şu görsel bar ile güncelle:
// <div class="w-full bg-gray-800 h-1.5 rounded-full mt-2 overflow-hidden">
//    <div class="h-full ${l.bg.replace('bg-', 'bg-').replace('/10', '')}" style="width: ${l.prob}%"></div>
// </div>
